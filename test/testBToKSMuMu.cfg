process TestBToKSMuMu = {

include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

source = PoolSource {
  untracked vstring fileNames = {
#    "file:/afs/cern.ch/user/d/drell/scratch0/keith/B0Ksmumu_gsd_6.root"
    "file:/tmp/llista/B0Ksmumu.root"
  }
}

untracked PSet maxEvents = {untracked int32 input = -1}

module muCands = ConcreteChargedCandidateProducer {
  InputTag src = ctfWithMaterialTracks
  string particleType = "mu+"
}

module goodMuons =  CandViewRefSelector {
  InputTag src = muCands
  string cut = "pt > 3 & abs(eta) < 2.6"
}

module piCands = ConcreteChargedCandidateProducer {
  InputTag src = ctfWithMaterialTracks
  string particleType = "pi+"
}

module goodPions =  CandViewRefSelector {
  InputTag src = piCands
  string cut = "abs(eta) < 2.6"
}

module kShortsBare = CandViewShallowCloneCombiner {
  string decay = "goodPions@+ goodPions@-"
  string cut = "0.3 < mass < 0.7"
  bool setLongLived = true
}
module kShorts = KinematicVertexFitCompositeCandProducer {
  InputTag src = kShortsBare
  bool setLongLived = true
}

module BdBare = CandViewShallowCloneCombiner {
  string decay = "kShorts goodMuons@+ goodMuons@-"
  string cut = "3.0 < mass < 7.0"
}

module Bd = KinematicVertexFitCompositeCandProducer {
  InputTag src = BdBare
} 

include "Configuration/EventContent/data/EventContent.cff"

block BToKSMuMuEventContent = {
  untracked vstring outputCommands = { }
}

block BToKSMuMuOutputCommands = {
  untracked vstring outputCommands = { 
    "keep *_*_*_TestBToKSMuMu"
  }
}

replace BToKSMuMuEventContent.outputCommands += AODEventContent.outputCommands
replace BToKSMuMuEventContent.outputCommands += BToKSMuMuOutputCommands.outputCommands

module out = PoolOutputModule {
  untracked string fileName = '/tmp/llista/B0Ksmumu_cands.root'
  using BToKSMuMuEventContent
}

  sequence dofit = { muCands, goodMuons, piCands, goodPions, kShortsBare, kShorts, BdBare, Bd }
  path pall = { dofit }
  endpath outpath = { out }
}
